// Quest Core - 4-Layer Repository System
// Surface (Public) → Working (Selective) → Personal (Private) → Deep (System)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("NEON_QUEST_CORE_DATABASE_URL")
  directUrl = env("NEON_QUEST_CORE_DIRECT_URL")
}

// Core Entity Models
model Company {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  website       String?  @unique
  domain        String?
  industry      String?
  sizeRange     String?  @map("size_range")
  logoUrl       String?  @map("logo_url")
  description   String?
  verified      Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  workExperiences     WorkExperience[]
  workingProjects     WorkingProject[]
  professionalContacts ProfessionalContact[]

  @@map("companies")
}

model Skill {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String   @unique
  category          String?
  subcategory       String?
  difficultyLevel   String?  @map("difficulty_level")
  marketDemandScore Int?     @map("market_demand_score")
  description       String?
  verified          Boolean  @default(false)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  userSkills UserSkill[]

  @@map("skills")
}

model EducationalInstitution {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  website   String?
  type      String?
  country   String?
  verified  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  userEducation UserEducation[]

  @@map("educational_institutions")
}

model Certification {
  id                 String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String
  issuingOrganization String? @map("issuing_organization")
  website            String?
  category           String?
  validityPeriod     Int?     @map("validity_period")
  description        String?
  verified           Boolean  @default(false)
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  userCertifications UserCertification[]

  @@map("certifications")
}

// Enhanced Users Model
model User {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerkId   String   @unique @map("clerk_id")
  email     String   @unique
  name      String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Surface Repo
  surfaceProfile    SurfaceProfile?
  workExperiences   WorkExperience[]
  userSkills        UserSkill[]
  userEducation     UserEducation[]
  userCertifications UserCertification[]

  // Working Repo
  workingProfile     WorkingProfile?
  workingProjects    WorkingProject[]
  workingAchievements WorkingAchievement[]
  workingMedia       WorkingMedia[]
  workingAccessPermissions WorkingAccessPermission[]

  // Personal Repo
  personalGoals     PersonalGoal[]
  personalNotes     PersonalNote[]
  objectives        Objective[]

  // Deep Repo
  deepInsights      DeepInsight[]
  trinityCore       TrinityCore?
  trinityEvolution  TrinityEvolution[]
  careerPathAnalysis CareerPathAnalysis[]
  skillEvolutionAnalysis SkillEvolutionAnalysis[]
  repoHealthMetrics RepoHealthMetrics[]
  crossLayerInsights CrossLayerInsight[]

  // Commits System
  conversationCommits ConversationCommit[]
  commitBatches      CommitBatch[]

  // Professional Relationships
  professionalContacts ProfessionalContact[]
  workRelationships   WorkRelationship[]
  projectRelationships ProjectRelationship[]
  educationRelationships EducationRelationship[]

  // Voice Coaching
  conversations     Conversation[]

  @@map("users")
}

// Professional Relationship Models
model ProfessionalContact {
  id                    String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                  String
  email                 String?
  linkedinUrl           String?  @map("linkedin_url")
  currentCompanyId      String?  @map("current_company_id") @db.Uuid
  currentTitle          String?  @map("current_title")
  phone                 String?
  notes                 String?
  relationshipStrength  Int?     @map("relationship_strength")
  lastInteractionDate   DateTime? @map("last_interaction_date")
  createdBy             String   @map("created_by") @db.Uuid
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  creator               User     @relation(fields: [createdBy], references: [id])
  currentCompany        Company? @relation(fields: [currentCompanyId], references: [id])
  workRelationships     WorkRelationship[]
  projectRelationships  ProjectRelationship[]
  educationRelationships EducationRelationship[]

  @@map("professional_contacts")
}

// Surface Repo Models (Public Profile)
model SurfaceProfile {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @unique @map("user_id") @db.Uuid
  username  String?  @unique
  publicBio String?  @map("public_bio")
  headline  String?
  location  String?
  website   String?
  isPublic  Boolean  @default(false) @map("is_public")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("surface_profiles")
}

model WorkExperience {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String    @map("user_id") @db.Uuid
  companyId      String    @map("company_id") @db.Uuid
  title          String
  employmentType String?   @map("employment_type")
  startDate      DateTime? @map("start_date")
  endDate        DateTime? @map("end_date")
  isCurrent      Boolean   @default(false) @map("is_current")
  description    String?
  achievements   String[]
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user            User @relation(fields: [userId], references: [id])
  company         Company @relation(fields: [companyId], references: [id])
  workRelationships WorkRelationship[]

  @@map("work_experiences")
}

model UserSkill {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId              String   @map("user_id") @db.Uuid
  skillId             String   @map("skill_id") @db.Uuid
  proficiencyLevel    String?  @map("proficiency_level")
  yearsOfExperience   Int?     @map("years_of_experience")
  isShowcase          Boolean  @default(false) @map("is_showcase")
  endorsementsCount   Int      @default(0) @map("endorsements_count")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user  User  @relation(fields: [userId], references: [id])
  skill Skill @relation(fields: [skillId], references: [id])

  @@unique([userId, skillId])
  @@map("user_skills")
}

model UserEducation {
  id            String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String                @map("user_id") @db.Uuid
  institutionId String                @map("institution_id") @db.Uuid
  degree        String?
  fieldOfStudy  String?               @map("field_of_study")
  startDate     DateTime?             @map("start_date")
  endDate       DateTime?             @map("end_date")
  gpa           String?
  description   String?
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user                    User                      @relation(fields: [userId], references: [id])
  institution             EducationalInstitution    @relation(fields: [institutionId], references: [id])
  educationRelationships  EducationRelationship[]

  @@map("user_education")
}

model UserCertification {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String        @map("user_id") @db.Uuid
  certificationId String        @map("certification_id") @db.Uuid
  issuedDate      DateTime?     @map("issued_date")
  expiryDate      DateTime?     @map("expiry_date")
  credentialId    String?       @map("credential_id")
  credentialUrl   String?       @map("credential_url")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user          User          @relation(fields: [userId], references: [id])
  certification Certification @relation(fields: [certificationId], references: [id])

  @@map("user_certifications")
}

// Working Repo Models (Selective Portfolio)
model WorkingProfile {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @unique @map("user_id") @db.Uuid
  title       String
  description String?
  bannerImage String?  @map("banner_image")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user                     User                       @relation(fields: [userId], references: [id])
  workingProjects          WorkingProject[]
  workingAchievements      WorkingAchievement[]
  workingMedia             WorkingMedia[]
  workingAccessPermissions WorkingAccessPermission[]
  workingAccessLogs        WorkingAccessLog[]

  @@map("working_profiles")
}

model WorkingProject {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String   @map("user_id") @db.Uuid
  workingProfileId  String   @map("working_profile_id") @db.Uuid
  title             String
  companyId         String?  @map("company_id") @db.Uuid
  description       String?
  challenge         String?
  solution          String?
  impact            String?
  technologies      Json?
  startDate         DateTime? @map("start_date")
  endDate           DateTime? @map("end_date")
  projectType       String?  @map("project_type")
  displayOrder      Int?     @map("display_order")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user                  User                    @relation(fields: [userId], references: [id])
  workingProfile        WorkingProfile          @relation(fields: [workingProfileId], references: [id])
  company               Company?                @relation(fields: [companyId], references: [id])
  workingMedia          WorkingMedia[]
  projectRelationships  ProjectRelationship[]

  @@map("working_projects")
}

model WorkingAchievement {
  id                 String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId             String   @map("user_id") @db.Uuid
  workingProfileId   String   @map("working_profile_id") @db.Uuid
  title              String
  description        String?
  context            String?
  quantifiedImpact   Json?    @map("quantified_impact")
  skillsDemonstrated Json?    @map("skills_demonstrated")
  recognition        String?
  dateAchieved       DateTime? @map("date_achieved")
  displayOrder       Int?     @map("display_order")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user           User           @relation(fields: [userId], references: [id])
  workingProfile WorkingProfile @relation(fields: [workingProfileId], references: [id])
  workingMedia   WorkingMedia[]

  @@map("working_achievements")
}

model WorkingMedia {
  id               String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId           String              @map("user_id") @db.Uuid
  workingProfileId String              @map("working_profile_id") @db.Uuid
  projectId        String?             @map("project_id") @db.Uuid
  achievementId    String?             @map("achievement_id") @db.Uuid
  mediaType        String              @map("media_type")
  title            String?
  description      String?
  fileUrl          String?             @map("file_url")
  fileSize         Int?                @map("file_size")
  mimeType         String?             @map("mime_type")
  thumbnailUrl     String?             @map("thumbnail_url")
  displayOrder     Int?                @map("display_order")
  createdAt        DateTime            @default(now()) @map("created_at")
  updatedAt        DateTime            @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user              User                @relation(fields: [userId], references: [id])
  workingProfile    WorkingProfile      @relation(fields: [workingProfileId], references: [id])
  project           WorkingProject?     @relation(fields: [projectId], references: [id])
  achievement       WorkingAchievement? @relation(fields: [achievementId], references: [id])

  @@map("working_media")
}

model WorkingAccessPermission {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workingProfileId String    @map("working_profile_id") @db.Uuid
  grantedToEmail   String?   @map("granted_to_email")
  grantedToName    String?   @map("granted_to_name")
  accessLevel      String?   @map("access_level")
  grantedBy        String    @map("granted_by") @db.Uuid
  grantedAt        DateTime  @default(now()) @map("granted_at")
  expiresAt        DateTime? @map("expires_at")
  isRevoked        Boolean   @default(false) @map("is_revoked")
  accessToken      String?   @unique @map("access_token")

  // Relationships
  workingProfile User           @relation(fields: [grantedBy], references: [id])
  profile        WorkingProfile @relation(fields: [workingProfileId], references: [id])

  @@map("working_access_permissions")
}

model WorkingAccessLog {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workingProfileId  String   @map("working_profile_id") @db.Uuid
  accessedByEmail   String?  @map("accessed_by_email")
  accessedByName    String?  @map("accessed_by_name")
  accessToken       String?  @map("access_token")
  accessedAt        DateTime @default(now()) @map("accessed_at")
  ipAddress         String?  @map("ip_address")
  userAgent         String?  @map("user_agent")
  pagesViewed       Json?    @map("pages_viewed")

  // Relationships
  workingProfile WorkingProfile @relation(fields: [workingProfileId], references: [id])

  @@map("working_access_logs")
}

// Personal Repo Models (Private Development)
model PersonalGoal {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId              String   @map("user_id") @db.Uuid
  goalType            String?  @map("goal_type")
  title               String?
  description         String?
  targetDate          DateTime? @map("target_date")
  progressPercentage  Int?     @map("progress_percentage")
  okrs                Json?
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("personal_goals")
}

model PersonalNote {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  noteType  String?  @map("note_type")
  content   String?
  tags      Json?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("personal_notes")
}

// OKR Models (Objectives and Key Results)
model Objective {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String   @map("user_id") @db.Uuid
  title         String
  description   String?
  category      String?  // professional, personal, learning, etc.
  priority      String?  // high, medium, low
  timeframe     String?  // quarter, year, etc.
  targetDate    DateTime? @map("target_date")
  status        String   @default("active") // active, completed, cancelled, on_hold
  progressScore Float?   @map("progress_score") // 0-100
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user        User        @relation(fields: [userId], references: [id])
  keyResults  KeyResult[]

  @@map("objectives")
}

model KeyResult {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  objectiveId    String   @map("objective_id") @db.Uuid
  title          String
  description    String?
  measurementType String? @map("measurement_type") // percentage, number, boolean, etc.
  targetValue    Float?   @map("target_value")
  currentValue   Float?   @map("current_value")
  unit           String?  // units, %, etc.
  status         String   @default("active") // active, completed, cancelled
  dueDate        DateTime? @map("due_date")
  completedAt    DateTime? @map("completed_at")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  objective Objective @relation(fields: [objectiveId], references: [id], onDelete: Cascade)

  @@map("key_results")
}

// Deep Repo Models (System-managed)
model DeepInsight {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  insightType     String?  @map("insight_type") // career, skill, relationship, goal, trinity, pattern
  category        String?  // professional, personal, learning, health
  title           String?  // Human-readable insight title
  description     String?  // Human-readable insight description
  aiAnalysis      Json?    @map("ai_analysis")
  confidenceScore Float?   @map("confidence_score")
  priority        String?  @default("medium") // high, medium, low
  actionable      Boolean? @default(false) // Whether this insight suggests specific actions
  actionItems     Json?    @map("action_items") // Structured action recommendations
  dataSource      String?  @map("data_source") // surface, working, personal, trinity, conversation
  triggerEvent    String?  @map("trigger_event") // What triggered this insight generation
  isArchived      Boolean  @default(false) @map("is_archived")
  generatedAt     DateTime @default(now()) @map("generated_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("deep_insights")
}

model TrinityCore {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @unique @map("user_id") @db.Uuid
  questAnalysis   Json?    @map("quest_analysis")
  serviceAnalysis Json?    @map("service_analysis")
  pledgeAnalysis  Json?    @map("pledge_analysis")
  coherenceScore  Float?   @map("coherence_score")
  maturityLevel   String?  @map("maturity_level") // emerging, developing, established, evolved
  evolutionStage  String?  @map("evolution_stage") // discovery, refinement, integration, mastery
  lastUpdated     DateTime @default(now()) @map("last_updated")

  // Relationships
  user User @relation(fields: [userId], references: [id])
  trinityEvolution TrinityEvolution[]

  @@map("trinity_core")
}

// Track Trinity evolution over time
model TrinityEvolution {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  trinityId       String   @map("trinity_id") @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  questSnapshot   Json?    @map("quest_snapshot")
  serviceSnapshot Json?    @map("service_snapshot")
  pledgeSnapshot  Json?    @map("pledge_snapshot")
  coherenceScore  Float?   @map("coherence_score")
  changeReason    String?  @map("change_reason") // user_update, insight_driven, coaching_session
  significantChange Boolean @default(false) @map("significant_change")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relationships
  trinityCore TrinityCore @relation(fields: [trinityId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("trinity_evolution")
}

// Advanced Deep Analysis Models
model CareerPathAnalysis {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  currentRole     String?  @map("current_role")
  targetRole      String?  @map("target_role")
  pathViability   Float?   @map("path_viability") // 0-1 score
  timeEstimate    String?  @map("time_estimate") // e.g., "2-3 years"
  keyMilestones   Json?    @map("key_milestones")
  skillGaps       Json?    @map("skill_gaps")
  recommendations Json?    @map("recommendations")
  confidenceScore Float?   @map("confidence_score")
  lastAnalyzed    DateTime @default(now()) @map("last_analyzed")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("career_path_analysis")
}

model SkillEvolutionAnalysis {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  skillName       String   @map("skill_name")
  currentLevel    String?  @map("current_level") // beginner, intermediate, advanced, expert
  growthRate      Float?   @map("growth_rate") // Skills gained per time period
  practiceFrequency String? @map("practice_frequency") // daily, weekly, monthly, rarely
  industryDemand  Float?   @map("industry_demand") // 0-1 score
  futureRelevance Float?   @map("future_relevance") // 0-1 score
  learningPath    Json?    @map("learning_path")
  relatedSkills   Json?    @map("related_skills")
  lastUpdated     DateTime @default(now()) @map("last_updated")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("skill_evolution_analysis")
}

model RepoHealthMetrics {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  overallScore    Float?   @map("overall_score") // 0-100
  surfaceScore    Float?   @map("surface_score") // Public profile completeness
  workingScore    Float?   @map("working_score") // Working portfolio strength
  personalScore   Float?   @map("personal_score") // Personal development tracking
  deepScore       Float?   @map("deep_score") // Trinity coherence + insights quality
  trinityAlignment Float?  @map("trinity_alignment") // How well layers align with Trinity
  dataFreshness   Float?   @map("data_freshness") // How recently data was updated
  engagementLevel Float?   @map("engagement_level") // User activity level
  recommendations Json?    @map("recommendations")
  calculatedAt    DateTime @default(now()) @map("calculated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("repo_health_metrics")
}

model CrossLayerInsight {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  insightType     String   @map("insight_type") // alignment, gap, opportunity, risk
  title           String   // Human-readable insight title
  description     String   // Detailed insight description
  affectedLayers  Json     @map("affected_layers") // Array of layer names
  dataConnections Json     @map("data_connections") // What data points are connected
  actionPriority  String   @map("action_priority") // immediate, short_term, long_term
  potentialImpact Float?   @map("potential_impact") // 0-1 score
  confidenceScore Float    @map("confidence_score")
  status          String   @default("active") // active, acknowledged, resolved, dismissed
  generatedAt     DateTime @default(now()) @map("generated_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])

  @@map("cross_layer_insights")
}

// Commits System Models - AI-driven conversation extraction staging
model ConversationCommit {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  batchId         String?  @map("batch_id") @db.Uuid
  extractionType  String   @map("extraction_type") // skill, experience, education, objective, key_result
  status          String   @default("pending") // pending, approved, rejected, committed
  confidence      Float    @map("confidence_score") // AI confidence in extraction
  aiSummary       String   @map("ai_summary") // AI-generated description of what was extracted
  originalText    String   @map("original_text") // The original conversation text
  extractedData   Json     @map("extracted_data") // Structured data extracted by AI
  suggestedEdits  Json?    @map("suggested_edits") // User modifications to AI extraction
  commitMessage   String?  @map("commit_message") // Git-style commit message
  conversationId  String?  @map("conversation_id") // Link to voice session if applicable
  reviewNotes     String?  @map("review_notes") // User notes during review
  targetLayer     String   @map("target_layer") // surface, working, personal, deep
  createdAt       DateTime @default(now()) @map("created_at")
  reviewedAt      DateTime? @map("reviewed_at")
  committedAt     DateTime? @map("committed_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])
  batch CommitBatch? @relation(fields: [batchId], references: [id])

  @@map("conversation_commits")
}

model CommitBatch {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  batchTitle      String   @map("batch_title") // e.g., "Voice Session - July 16, 2025"
  batchType       String   @map("batch_type") // voice_session, chat_session, document_upload, manual
  sessionSummary  String?  @map("session_summary") // AI summary of the entire session
  totalCommits    Int      @default(0) @map("total_commits")
  pendingCommits  Int      @default(0) @map("pending_commits")
  approvedCommits Int      @default(0) @map("approved_commits")
  rejectedCommits Int      @default(0) @map("rejected_commits")
  committedCommits Int     @default(0) @map("committed_commits")
  batchStatus     String   @default("active") // active, completed, archived
  aiInsights      Json?    @map("ai_insights") // Overall insights from the session
  sessionMetadata Json?    @map("session_metadata") // Duration, quality, etc.
  createdAt       DateTime @default(now()) @map("created_at")
  completedAt     DateTime? @map("completed_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user User @relation(fields: [userId], references: [id])
  commits ConversationCommit[]

  @@map("commit_batches")
}

// Professional Relationship Models
model WorkRelationship {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                  String   @map("user_id") @db.Uuid
  workExperienceId        String   @map("work_experience_id") @db.Uuid
  contactId               String   @map("contact_id") @db.Uuid
  relationshipType        String?  @map("relationship_type")
  relationshipDescription String?  @map("relationship_description")
  collaborationContext    String?  @map("collaboration_context")
  startDate               DateTime? @map("start_date")
  endDate                 DateTime? @map("end_date")
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user           User                 @relation(fields: [userId], references: [id])
  workExperience WorkExperience       @relation(fields: [workExperienceId], references: [id])
  contact        ProfessionalContact  @relation(fields: [contactId], references: [id])

  @@map("work_relationships")
}

model ProjectRelationship {
  id                   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId               String   @map("user_id") @db.Uuid
  projectId            String   @map("project_id") @db.Uuid
  contactId            String   @map("contact_id") @db.Uuid
  relationshipType     String?  @map("relationship_type")
  roleDescription      String?  @map("role_description")
  collaborationDetails String?  @map("collaboration_details")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user    User                @relation(fields: [userId], references: [id])
  project WorkingProject      @relation(fields: [projectId], references: [id])
  contact ProfessionalContact @relation(fields: [contactId], references: [id])

  @@map("project_relationships")
}

model EducationRelationship {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId              String   @map("user_id") @db.Uuid
  educationId         String   @map("education_id") @db.Uuid
  contactId           String   @map("contact_id") @db.Uuid
  relationshipType    String?  @map("relationship_type")
  subjectArea         String?  @map("subject_area")
  interactionContext  String?  @map("interaction_context")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user      User                @relation(fields: [userId], references: [id])
  education UserEducation       @relation(fields: [educationId], references: [id])
  contact   ProfessionalContact @relation(fields: [contactId], references: [id])

  @@map("education_relationships")
}

// Voice Coaching Models (Enhanced)
model Conversation {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  sessionId   String    @unique @map("session_id")
  type        String?
  summary     String?
  emotions    Json?
  repoContext Json?     @map("repo_context")
  startedAt   DateTime  @default(now()) @map("started_at")
  endedAt     DateTime? @map("ended_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")

  // Relationships
  user     User      @relation(fields: [userId], references: [id])
  messages Message[]

  @@map("conversations")
}

model Message {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversationId String   @map("conversation_id") @db.Uuid
  role           String
  content        String
  emotions       Json?
  repoReferences Json?    @map("repo_references")
  createdAt      DateTime @default(now()) @map("created_at")

  // Relationships
  conversation Conversation @relation(fields: [conversationId], references: [id])

  @@map("messages")
}